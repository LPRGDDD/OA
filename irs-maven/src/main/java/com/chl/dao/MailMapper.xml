<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.chl.dao.MailDao" >
         <select id="getAllUsers" parameterType="String" resultType="java.util.Map">
        select * from tb_admin a join tb_dept d on a.dept_id=d.dept_id
        <where>
            <if test="keyWord !=null and keyWord!=''">
                a.fullname like '%${keyWord}%' or d.dept_name like '%${keyWord}%'
            </if>
        </where>
    </select>
 <!--添加email-->
    <insert id="addMail" parameterType="java.util.Map">
        insert into tb_mail(from_id,to_id2,subject,content,sendtime,send_flag)
        values(#{user_id},#{to_id2},#{theme},#{content},NOW(),1)
    </insert>
    <!--添加草稿箱email-->
     <insert id="saveMail" parameterType="java.util.Map">
        insert into tb_mail(from_id,to_id2,subject,content,sendtime,send_flag)
        values(#{user_id},#{to_id2},#{theme},#{content},NOW(),0)
    </insert>
     <!--查询未读邮件-->
    <select id="getMail" resultType="java.util.Map">
        select * from tb_mail m join tb_admin a on m.from_id=a.id
        <where>
            <if test="userId!='' and  userId!=null">
               send_flag=1 and m.to_id2=#{userId}
            </if>
            <if test="keyWord !=null and keyWord!=''">
               and a.username like '%${keyWord}%'
            </if>
        </where>
    </select>
    <!-- 查询未发送邮件 -->
     <select id="selectWMail" resultType="java.util.Map">
        select * from tb_mail m join tb_admin a on m.from_id=a.id
        <where>
            <if test="userId!='' and  userId!=null">
               send_flag=0 and m.from_id=#{userId}
            </if>
            <if test="keyWord !=null and keyWord!=''">
               and a.fullname like '%${keyWord}%'
            </if>
        </where>
    </select>
    
    <!-- 查询未读邮件条数-->
    <select id="selectMail" resultType="int">
    select count(*) from tb_mail where send_flag=1
    </select>
    <!--查询收件箱详情  -->
    <select id="selectXMail" resultType="java.util.Map">
      <!--  select * from tb_mail where emailId=#{emailId} -->
       select m.emailId, m.subject,m.sendtime,m.content,a.username from tb_mail m join tb_admin a on m.id=a.id
        <!-- <where>
            <if test="userId!='' and  userId!=null">
               send_flag=1 and m.to_id2=#{userId}
            </if>
            <if test="keyWord !=null and keyWord!=''">
               and u.user_name like '%${keyWord}%'
            </if>
        </where> -->
    </select>
    <!--删除已收邮件-->
    <delete id="delMail" parameterType="Integer">
        delete  from tb_mail where emailId=#{emailId}
    </delete> 
    <!-- 修改草稿箱 -->
     <update id="updateMail" parameterType="java.util.Map">
        update tb_mail set subject=#{subject},content=#{content}  where emailId=#{emailId}
    </update>
   </mapper>